/**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
(function(){function i(t){function a(e){var t;if(e.nodeType===1){t=e.getAttribute(n);if(t&&t!=="inherit")return t;t=e.contentEditable;if(t!=="inherit")return t}return null}function f(e){var t;while(e){t=a(e);if(t)return t==="false"?e:null;e=e.parentNode}}function l(e){while(e){if(e.id===u)return e;e=e.parentNode}}function c(t){var n;if(t){n=new e(t,t);for(t=n.current();t;t=n.next())if(t.nodeType===3)return t}}function h(e,n){var r,f;if(a(e)==="false"&&i.isBlock(e)){s.select(e);return}return f=i.createRng(),a(e)==="true"&&(e.firstChild||e.appendChild(t.getDoc().createTextNode(" ")),e=e.firstChild,n=!0),r=i.create("span",{id:u,"data-mce-bogus":!0},o),n?e.parentNode.insertBefore(r,e):i.insertAfter(r,e),f.setStart(r.firstChild,1),f.collapse(!0),s.setRng(f),r}function p(e){var t,n,r;if(e)rng=s.getRng(!0),rng.setStartBefore(e),rng.setEndBefore(e),t=c(e),t&&t.nodeValue.charAt(0)==o&&(t=t.deleteData(0,1)),i.remove(e,!0),s.setRng(rng);else{n=l(s.getStart());while((e=i.get(u))&&e!==r)n!==e&&(t=c(e),t&&t.nodeValue.charAt(0)==o&&(t=t.deleteData(0,1)),i.remove(e,!0)),r=e}}function d(){function u(t,n){var r,s,o,u,f;r=i.startContainer,s=i.startOffset;if(r.nodeType==3){f=r.nodeValue.length;if(s>0&&s<f||(n?s==f:s==0))return}else{if(!(s<r.childNodes.length))return n?null:t;var l=!n&&s>0?s-1:s;r=r.childNodes[l],r.hasChildNodes()&&(r=r.firstChild)}o=new e(r,t);while(u=o[n?"prev":"next"]()){if(u.nodeType===3&&u.nodeValue.length>0)return;if(a(u)==="true")return u}return t}var t,n,r,i,o;p(),r=s.isCollapsed(),t=f(s.getStart()),n=f(s.getEnd());if(t||n){i=s.getRng(!0);if(r){t=t||n;var l=s.getStart();(o=u(t,!0))?h(o,!0):(o=u(t,!1))?h(o,!1):s.select(t)}else i=s.getRng(!0),t&&i.setStartBefore(t),n&&i.setEndAfter(n),s.setRng(i)}}function v(t,n){function m(e,t){while(e=e[t?"previousSibling":"nextSibling"])if(e.nodeType!==3||e.nodeValue.length>0)return e}function g(e,t){s.select(e),s.collapse(t)}function y(e){function c(e){var t=r;while(t){if(t===e)return;t=t.parentNode}i.remove(e),d()}function h(){var n,i,s=t.schema.getNonEmptyElements();i=new tinymce.dom.TreeWalker(r,t.getBody());while(n=e?i.prev():i.next()){if(s[n.nodeName.toLowerCase()])break;if(n.nodeType===3&&tinymce.trim(n.nodeValue).length>0)break;if(a(n)==="false")return c(n),!0}return f(n)?!0:!1}var n,r,o,u;if(s.isCollapsed()){n=s.getRng(!0),r=n.startContainer,o=n.startOffset,r=l(r)||r;if(u=f(r))return c(u),!1;if(r.nodeType==3&&(e?o>0:o<r.nodeValue.length))return!0;r.nodeType==1&&(r=r.childNodes[o]||r);if(h())return!1}return!0}var o=n.keyCode,u,c,h,v;h=s.getStart(),v=s.getEnd(),u=f(h)||f(v);if(u&&(o<112||o>124)&&o!=r.DELETE&&o!=r.BACKSPACE){if((tinymce.isMac?n.metaKey:n.ctrlKey)&&(o==67||o==88||o==86))return;n.preventDefault();if(o==r.LEFT||o==r.RIGHT){var b=o==r.LEFT;if(t.dom.isBlock(u)){var w=b?u.previousSibling:u.nextSibling,E=new e(w,w),S=b?E.prev():E.next();g(S,!b)}else g(u,b)}}else if(o==r.LEFT||o==r.RIGHT||o==r.BACKSPACE||o==r.DELETE){c=l(h);if(c){if(o==r.LEFT||o==r.BACKSPACE){u=m(c,!0);if(u&&a(u)==="false"){n.preventDefault();if(o!=r.LEFT){i.remove(u);return}g(u,!0)}else p(c)}if(o==r.RIGHT||o==r.DELETE){u=m(c);if(u&&a(u)==="false"){n.preventDefault();if(o!=r.RIGHT){i.remove(u);return}g(u,!1)}else p(c)}}if((o==r.BACKSPACE||o==r.DELETE)&&!y(o==r.BACKSPACE))return n.preventDefault(),!1}}var i=t.dom,s=t.selection,o,u="mce_noneditablecaret",o="﻿";t.onMouseDown.addToTop(function(e,t){var n=e.selection.getNode();a(n)==="false"&&n==t.target&&d()}),t.onMouseUp.addToTop(d),t.onKeyDown.addToTop(v),t.onKeyUp.addToTop(d)}var e=tinymce.dom.TreeWalker,t="contenteditable",n="data-mce-"+t,r=tinymce.VK;tinymce.create("tinymce.plugins.NonEditablePlugin",{init:function(e,r){function a(e,t){var n=u.length,r=t.content,i=tinymce.trim(o);if(t.format=="raw")return;while(n--)r=r.replace(u[n],function(t){var n=arguments,s=n[n.length-2];return s>0&&r.charAt(s-1)=='"'?t:'<span class="'+i+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode(typeof n[1]=="string"?n[1]:n[0])+"</span>"});t.content=r}var s,o,u;s=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ",o=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",u=e.getParam("noneditable_regexp"),u&&!u.length&&(u=[u]),e.onPreInit.add(function(){i(e),u&&(e.selection.onBeforeSetContent.add(a),e.onBeforeSetContent.add(a)),e.parser.addAttributeFilter("class",function(e){var t=e.length,r,i;while(t--)i=e[t],r=" "+i.attr("class")+" ",r.indexOf(s)!==-1?i.attr(n,"true"):r.indexOf(o)!==-1&&i.attr(n,"false")}),e.serializer.addAttributeFilter(n,function(e,r){var i=e.length,s;while(i--)s=e[i],u&&s.attr("data-mce-content")?(s.name="#text",s.type=3,s.raw=!0,s.value=s.attr("data-mce-content")):(s.attr(t,null),s.attr(n,null))}),e.parser.addAttributeFilter(t,function(e,r){var i=e.length,s;while(i--)s=e[i],s.attr(n,s.attr(t)),s.attr(t,null)})})},getInfo:function(){return{longname:"Non editable elements",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/noneditable",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("noneditable",tinymce.plugins.NonEditablePlugin)})();